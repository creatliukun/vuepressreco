---
title: 浏览器渲染
date: 2025-03-30
tags:
 - brower
categories:
# 浏览器
 - Brower
---
# 浏览器渲染

浏览器的渲染过程是一个复杂且高度优化的过程，涉及 HTML、CSS 和 JavaScript 的解析与执行。以下是详细的步骤说明：

---

## 1. **HTML 解析**

### 1.1 初始阶段
- 当浏览器接收到 HTML 文件时，会从上到下逐行解析。
- 解析过程中，HTML 被转换为一个 **DOM（Document Object Model）树**，这是页面结构的表示形式。

### 1.2 标签解析
- 浏览器遇到标签时，会根据标签类型进行不同的处理：
  - **普通标签**：直接创建对应的 DOM 节点并插入到 DOM 树中。
  - **脚本标签 `<script>`**：
    - 如果是内联脚本（`<script>...</script>`），浏览器会暂停 HTML 解析，立即执行脚本。
    - 如果是外部脚本（`<script src="..."></script>`），浏览器会发起网络请求下载脚本文件，并在下载完成后执行。
    - 默认情况下，脚本是阻塞的（blocking），即 HTML 解析会被暂停，直到脚本执行完成。
  - **样式表 `<link>`**：
    - 遇到 `<link rel="stylesheet">` 时，浏览器会发起 CSS 文件的下载请求。
    - CSS 是渲染阻塞的（render-blocking），即浏览器不会开始渲染页面，直到所有 CSS 文件加载完成。

### 1.3 DOM 构建完成
- 当 HTML 文件完全解析后，DOM 树构建完成。

---

## 2. **CSS 解析**

### 2.1 下载与解析
- 浏览器下载所有引用的 CSS 文件，并将其解析为 **CSSOM（CSS Object Model）树**。
- CSSOM 是一个类似于 DOM 的树状结构，用于表示页面的样式规则。

### 2.2 样式计算
- 浏览器将 DOM 树和 CSSOM 树结合起来，计算每个 DOM 节点的具体样式。
- 这个过程称为 **样式计算（Style Calculation）**，结果是一个包含每个节点样式的映射表。

---

## 3. **布局（Layout/Reflow）**

### 3.1 布局计算
- 在样式计算完成后，浏览器进入布局阶段。
- 布局阶段的主要任务是确定每个 DOM 节点在页面中的位置和尺寸。
- 这个过程也被称为 **回流（Reflow）** 或 **重排（Relayout）**。

### 3.2 布局树
- 布局阶段生成一个 **布局树（Layout Tree）**，它是 DOM 树的一个子集，仅包含可见的节点（如 `display: none` 的节点不会出现在布局树中）。

---

## 4. **绘制（Painting）**

### 4.1 绘制准备
- 在布局完成后，浏览器进入绘制阶段。
- 绘制阶段的主要任务是将布局树转换为屏幕上的像素。
- 浏览器会为每个节点生成多个图层（Layers），每个图层负责绘制特定的内容（如背景、文本、边框等）。

### 4.2 绘制顺序
- 绘制顺序遵循一定的规则，通常包括以下内容：
  1. 背景颜色或图片
  2. 边框
  3. 文本内容
  4. 其他装饰性元素（如阴影、渐变等）

---

## 5. **合成（Compositing）**

### 5.1 图层合并
- 在绘制完成后，浏览器进入合成阶段。
- 合成阶段的主要任务是将所有图层合并为最终的画面，并显示在屏幕上。
- 浏览器会利用 GPU 加速这一过程，以提高性能。

### 5.2 动画优化
- 如果页面中有动画效果，浏览器会尽量避免重新计算布局或重新绘制，而是通过调整图层的透明度、位置等属性来实现动画。

---

## 6. **JavaScript 执行**

### 6.1 脚本执行
- 在 HTML 解析过程中，遇到 `<script>` 标签时，浏览器会暂停 HTML 解析并执行脚本。
- 如果脚本修改了 DOM 或 CSSOM，可能会触发重新布局或重新绘制。

### 6.2 异步脚本
- 使用 `async` 属性的脚本会在后台下载，下载完成后立即执行，但不会阻塞 HTML 解析。
- 使用 `defer` 属性的脚本也会在后台下载，但在 HTML 解析完成后按顺序执行。

---

## 总结

浏览器的渲染过程可以概括为以下几个关键阶段：

1. **HTML 解析**：生成 DOM 树。
2. **CSS 解析**：生成 CSSOM 树。
3. **样式计算**：结合 DOM 和 CSSOM，计算每个节点的样式。
4. **布局**：计算每个节点的位置和尺寸。
5. **绘制**：将布局树转换为屏幕上的像素。
6. **合成**：将图层合并为最终画面。
7. **JavaScript 执行**：动态修改 DOM 或 CSSOM，可能触发重新布局或重新绘制。

这些阶段环环相扣，任何一个阶段的延迟都会影响整体渲染性能。因此，在开发中应尽量减少阻塞操作（如大文件下载、复杂的样式计算等），以提升页面加载速度和用户体验。
